# BMB Development Principles

> **Performance > Everything**

이 문서는 BMB 언어 개발의 핵심 원칙과 벤치마크 주도 개발 프로세스를 정의합니다.

---

## 1. 핵심 목표: 성능

BMB의 유일한 목표는 **성능**입니다. 다른 모든 가치(안정성, 편의성, 복잡도)는 성능 달성을 위해 희생될 수 있습니다.

```
Performance 추구
    → 런타임 체크 제거 필요
    → 컴파일타임 증명 필요
    → 증명된 코드는 자동으로 안전
```

### 왜 성능인가?

- **안정성**은 독립적 목표가 아닙니다. 성능을 위해 런타임 체크를 제거하면, 컴파일타임 증명이 필요하고, 증명된 코드는 자동으로 안전합니다.
- **편의성**은 AI가 감당합니다. 인간에게 장황한 코드/Contract 작성이 불가능해도, AI는 이를 수행할 수 있습니다.
- **복잡도**는 기피 사유가 아닙니다. 근본 해결을 위해 필요한 복잡도는 수용합니다.

---

## 2. 벤치마크 주도 개발 (Benchmark-Driven Development)

### 2.1. 프로세스 사이클

```
┌─────────────────────────────────────────────────────────┐
│                                                         │
│   ┌──────────────┐      ┌──────────────┐               │
│   │ 1. 벤치마크  │ ───▶ │ 2. 성능 측정 │               │
│   │    실행      │      │   분석       │               │
│   └──────────────┘      └──────────────┘               │
│          ▲                     │                        │
│          │                     ▼                        │
│   ┌──────────────┐      ┌──────────────┐               │
│   │ 5. 검증 및   │ ◀─── │ 3. 근본 원인 │               │
│   │    반복      │      │   파악       │               │
│   └──────────────┘      └──────────────┘               │
│          ▲                     │                        │
│          │                     ▼                        │
│          │              ┌──────────────┐               │
│          └───────────── │ 4. 언어/컴파 │               │
│                         │    일러 수정 │               │
│                         └──────────────┘               │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

### 2.2. 각 단계 상세

#### Step 1: 벤치마크 실행

```bash
# 전체 벤치마크 실행
./ecosystem/benchmark-bmb/run.sh

# 특정 벤치마크 실행
./ecosystem/benchmark-bmb/run.sh fibonacci

# C/Rust 비교 실행
./ecosystem/benchmark-bmb/run.sh --compare
```

#### Step 2: 성능 측정 및 분석

| 비율 | 상태 | 조치 |
|------|------|------|
| ≤ 1.00x | ✅ BMB > C | 다음 벤치마크로 이동 |
| 1.00x ~ 1.10x | ✅ 동등 | 허용 가능, 최적화 선택적 |
| 1.10x ~ 1.50x | ⚠️ 느림 | 조사 필수 |
| > 1.50x | ❌ 심각 | 즉시 수정 필요 |

#### Step 3: 근본 원인 파악

**Decision Framework** (반드시 위에서부터 검토):

| 순위 | 수준 | 검토 질문 |
|------|------|----------|
| 1 | **언어 스펙** | 이 기능이 언어에 있어야 하는가? |
| 2 | **컴파일러 구조** | MIR/AST가 이를 표현할 수 있는가? |
| 3 | **최적화 패스** | 최적화 패스가 이를 처리하는가? |
| 4 | **코드 생성** | 생성되는 IR이 최적인가? |
| 5 | **런타임** | 런타임이 지원해야 하는가? |

**경고**: 낮은 수준에서 해결하려는 유혹을 경계하라. 1번에서 해결할 문제를 4번에서 해결하면 그것은 **workaround**다.

#### Step 4: 언어/컴파일러 수정

- 스펙 변경이 필요하면 **스펙을 변경**한다
- 컴파일러 구조 변경이 필요하면 **구조를 변경**한다
- 작업량이 크다는 것은 하지 않을 이유가 **아니다**

#### Step 5: 검증 및 반복

```bash
# 수정 후 벤치마크 재실행
./ecosystem/benchmark-bmb/run.sh

# 어셈블리 비교 (동일 IR 확인)
diff <(./target/release/bmb build test.bmb --emit-ir) expected.ll
```

**목표 달성까지 반복**한다.

---

## 3. 성능 동등/추월의 유일한 조건

> **BMB >= C/Rust** 달성의 유일한 조건은 **동일한 IR 생성**입니다.

```
BMB Source → MIR → LLVM IR → Native Code
C Source   → Clang AST → LLVM IR → Native Code
                   ↓
            동일한 LLVM IR = 동일한 성능
```

### 동일 IR 검증 방법

```bash
# BMB IR 생성
./target/release/bmb build test.bmb --emit-ir -o bmb.ll

# C IR 생성
clang -O3 -S -emit-llvm test.c -o c.ll

# 비교 (핵심 로직)
diff bmb.ll c.ll
```

**C/Rust가 이미 최적화된 경우**, BMB가 동일한 IR을 생성하면 성능은 **동등**합니다.

---

## 4. 부정행위 금지

### 4.1. 금지된 행위

| 행위 | 설명 | 올바른 대응 |
|------|------|------------|
| **벤치마크 조작** | BMB에 유리하게 벤치마크 수정 | 공정한 비교 유지 |
| **불공정 비교** | 최적화 수준 불일치 | 동일 `-O3` 수준 |
| **작업량 불일치** | BMB가 더 적은 작업 수행 | 동일 작업량 보장 |
| **워크어라운드** | 근본 해결 대신 우회 | 언어/컴파일러 수정 |

### 4.2. 비판적 점검 체크리스트

모든 성능 개선에 대해:

- [ ] 벤치마크가 C/Rust와 동일한 작업을 수행하는가?
- [ ] 최적화 수준이 동일한가? (`-O3` vs `-O3`)
- [ ] 알고리즘이 동일한가? (O(n) vs O(n))
- [ ] 데이터 크기가 동일한가?
- [ ] 측정 방법이 공정한가? (warm-up, 반복 횟수)
- [ ] 이것은 workaround인가, proper fix인가?

---

## 5. 연구 및 조사 활용

### 5.1. 적극 활용 대상

| 영역 | 활용 사례 |
|------|----------|
| **최신 연구** | LLVM 최적화, 컴파일러 기법 |
| **수학** | 타입 이론, SMT 솔버 |
| **컴퓨터 공학** | CPU 아키텍처, 캐시 최적화 |
| **벤치마크 분석** | 성능 프로파일링, 어셈블리 분석 |

### 5.2. 조사 트리거

다음 상황에서 web-search/research 수행:

- 성능 차이 원인 불명확
- 최적화 기법 탐색 필요
- LLVM IR 패턴 조사
- 다른 언어의 해결책 참고

---

## 6. 원칙 요약

| 번호 | 원칙 | 설명 |
|------|------|------|
| **P1** | 성능 저하는 버그다 | 성능 문제 = 기능 버그 동일 심각도 |
| **P2** | Workaround 금지 | 근본 해결만 허용 |
| **P3** | 복잡도는 기피 사유 아님 | 어려운 해결책이 proper fix |
| **P4** | 언어 한계는 답이 아님 | 한계가 있으면 언어를 바꾼다 |
| **P5** | 측정 없는 주장 금지 | 모든 성능 주장은 벤치마크로 증명 |
| **P6** | 부정행위 금지 | 공정한 비교만 허용 |

---

## 관련 문서

- [DEVELOPMENT.md](DEVELOPMENT.md) - 개발 가이드라인
- [ROADMAP.md](ROADMAP.md) - 개발 로드맵
- [SPECIFICATION.md](SPECIFICATION.md) - 언어 스펙
- [ARCHITECTURE.md](ARCHITECTURE.md) - 컴파일러 아키텍처
