// v0.85: Basic scoped threads test
// Tests Scope type creation, spawn, and wait

fn main() -> i64 = {
    // Create a scope for structured thread management
    let s: Scope = thread_scope();

    // Create shared counter
    let counter: Atomic<i64> = Atomic::new(0);

    // Spawn scoped threads using .spawn() method
    s.spawn(fn || { counter.fetch_add(10); () });
    s.spawn(fn || { counter.fetch_add(20); () });

    // Wait for all scoped threads to complete
    s.wait();

    // Counter should be 30
    let result = counter.load();
    if result == 30 { 0 } else { 1 }
};
