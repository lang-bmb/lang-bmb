// v0.73: Basic Channel test
// Tests bounded MPSC channel for inter-thread communication

fn producer(tx: Sender<i64>) -> i64 = {
    // Send values to the channel
    tx.send(10);
    tx.send(20);
    tx.send(30);
    0
};

fn main() -> i64 = {
    // Create a bounded channel with capacity 10
    let ch = channel<i64>(10);
    let tx = ch.0;  // Sender
    let rx = ch.1;  // Receiver

    // Spawn a producer thread
    let t = spawn { producer(tx) };

    // Receive values from the channel
    let v1 = rx.recv();
    let v2 = rx.recv();
    let v3 = rx.recv();

    // Wait for producer to finish
    let _ignored = t.join();

    // Check if values were received correctly
    let sum = v1 + v2 + v3;  // Should be 60
    if sum == 60 {
        0  // Success
    } else {
        1  // Failure
    }
};
