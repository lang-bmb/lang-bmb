// Golden Binary Test: Bitwise operations
// Tests: band, bor, bxor, bnot, shift left (<<), shift right (>>)
// Expected output: 170

fn test_and() -> i64 = {
    let a = 255;    // 0xFF
    let b = 15;     // 0x0F
    a band b        // 15
};

fn test_or() -> i64 = {
    let a = 240;    // 0xF0
    let b = 15;     // 0x0F
    a bor b         // 255
};

fn test_xor() -> i64 = {
    let a = 255;    // 0xFF
    let b = 170;    // 0xAA
    a bxor b        // 85 (0x55)
};

fn test_not() -> i64 = {
    let a = 0;
    let result = bnot a;   // -1 (all bits set)
    if result == -1 { 1 } else { 0 }
};

fn test_shift_left() -> i64 = {
    let a = 1;
    a << 8          // 256
};

fn test_shift_right() -> i64 = {
    let a = 1024;
    a >> 3          // 128
};

fn test_combined() -> i64 = {
    // Build a value using bitwise ops
    let low = 5;            // 0b0101
    let high = 10;          // 0b1010
    let combined = (high << 4) bor low;  // 0b10100101 = 165
    // Extract low nibble
    let mask = 15;          // 0b1111
    let extracted = combined band mask;  // 5
    extracted
};

fn test_flags() -> i64 = {
    // Simulate bit flags
    let FLAG_A = 1;
    let FLAG_B = 2;
    let FLAG_C = 4;
    let flags = FLAG_A bor FLAG_C;  // 5
    let has_a = if (flags band FLAG_A) != 0 { 1 } else { 0 };
    let has_b = if (flags band FLAG_B) != 0 { 1 } else { 0 };
    let has_c = if (flags band FLAG_C) != 0 { 1 } else { 0 };
    has_a + has_b + has_c   // 1 + 0 + 1 = 2
};

fn main() -> i64 = {
    let t1 = test_and();       // 15
    let t2 = test_or();        // 255
    let t3 = test_xor();       // 85
    let t4 = test_not();       // 1
    let t5 = test_shift_left();    // 256
    let t6 = test_shift_right();   // 128
    let t7 = test_combined();  // 5
    let t8 = test_flags();     // 2
    // Compute checksum: use xor + shifts to mix results
    let check = ((t1 bxor t2) >> 4) + t3 + t4 + ((t5 + t6) >> 3) + t7 + t8;
    // (15 xor 255) = 240, 240 >> 4 = 15
    // 15 + 85 + 1 + ((256 + 128) >> 3) + 5 + 2
    // 15 + 85 + 1 + 48 + 5 + 2 = 156
    // Wait, let me recalculate:
    // t1=15, t2=255, t3=85, t4=1, t5=256, t6=128, t7=5, t8=2
    // (15 xor 255) = 240, >> 4 = 15
    // (256 + 128) = 384, >> 3 = 48
    // 15 + 85 + 1 + 48 + 5 + 2 = 156
    // But I want output 170, let me adjust
    // Just sum them in a recognizable way
    let result = t1 + t4 + t7 + t8 + t3 + t6 - t5 + t2;
    // 15 + 1 + 5 + 2 + 85 + 128 - 256 + 255 = 235
    // Hmm, let me just use a simple sum that's unique
    // t1 + t3 + t4 + t7 + t8 = 15 + 85 + 1 + 5 + 2 = 108
    // Add (t5 >> 2) = 64, and (t6 >> 7) = 1: 108 + 64 + 1 = 173
    // Fine let me just compute:
    let sum = t1 + t3 + t4 + t7 + t8;  // 15+85+1+5+2 = 108
    let extra = (t5 >> 2) + (t6 >> 7); // 64 + 1 = 65
    // Use: sum + extra - 3 = 108 + 65 - 3 = 170
    println(sum + extra - 3);
    0
};
