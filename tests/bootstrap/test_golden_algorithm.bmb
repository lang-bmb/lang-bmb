// Golden Binary Test: Algorithmic complexity
// Tests: bubble sort, binary search, GCD, array manipulation
// Exercises: nested loops, array indexing/mutation, recursive algorithms

// Bubble sort single pass: compare adjacent pairs, swap if needed
fn bubble_pass(arr: [i64], len: i64, i: i64) -> i64 =
    if i >= len - 1 { 0 }
    else {
        let next = if arr[i] > arr[i + 1] {
            let tmp = arr[i];
            set arr[i] = arr[i + 1];
            set arr[i + 1] = tmp;
            1
        } else { 0 };
        bubble_pass(arr, len, i + 1)
    };

// Bubble sort: repeat passes until sorted
fn bubble_sort(arr: [i64], len: i64, pass: i64) -> i64 =
    if pass >= len { 0 }
    else {
        let r = bubble_pass(arr, len, 0);
        bubble_sort(arr, len, pass + 1)
    };

// Check if array is sorted: returns 1 if sorted, 0 otherwise
fn is_sorted(arr: [i64], len: i64, i: i64) -> i64 =
    if i >= len - 1 { 1 }
    else if arr[i] > arr[i + 1] { 0 }
    else { is_sorted(arr, len, i + 1) };

// Binary search: returns index or -1
fn binary_search(arr: [i64], target: i64, lo: i64, hi: i64) -> i64 =
    if lo > hi { 0 - 1 }
    else {
        let mid = lo + (hi - lo) / 2;
        if arr[mid] == target { mid }
        else if arr[mid] < target { binary_search(arr, target, mid + 1, hi) }
        else { binary_search(arr, target, lo, mid - 1) }
    };

// GCD using Euclidean algorithm
fn gcd(a: i64, b: i64) -> i64 =
    if b == 0 { a }
    else { gcd(b, a - (a / b) * b) };

// Sum of array elements using for-in
fn array_sum_for(arr: [i64], len: i64) -> i64 = {
    let mut total = 0;
    for i in 0..len {
        total = total + arr[i];
        0
    };
    total
};

fn main() -> i64 = {
    // Test 1: Bubble sort
    let arr = [50, 30, 10, 40, 20];
    let s = bubble_sort(arr, 5, 0);
    let sorted = is_sorted(arr, 5, 0);
    // arr should be [10, 20, 30, 40, 50], sorted = 1

    // Test 2: Binary search in sorted array
    let idx30 = binary_search(arr, 30, 0, 4);
    // should find 30 at index 2
    let idx99 = binary_search(arr, 99, 0, 4);
    // should return -1

    // Test 3: GCD
    let g1 = gcd(48, 18);
    // gcd(48,18) = 6
    let g2 = gcd(100, 75);
    // gcd(100,75) = 25

    // Test 4: Sum sorted array
    let total = array_sum_for(arr, 5);
    // 10+20+30+40+50 = 150

    // Results:
    // sorted=1, idx30=2, idx99=-1, g1=6, g2=25, total=150
    // Output: 1 + 2 + (-1) + 6 + 25 + 150 = 183
    println(sorted + idx30 + idx99 + g1 + g2 + total);
    0
};
